{% extends 'base.html' %}
{% load static %}

{% block title%}
Sailam QR Code Scanner
{% endblock title%}

{%block header_files%}
<script src="{% static 'js/jquery.min.js'%}"></script>
<script src="{% static 'js/instascan.min.js'%}"></script>
{%endblock header_files%}

{%block content%}
<div class="card" style="width: 18rem">
  <button class="btn btn-primary" type="button" id="toggleButton" name="toggleButton">Start Camera</button>
  <video id="preview"></video></div>
</div>
  <div class="card-body">
    <h5 class="card-title">Scan QR Code</h5>
    <div class="input-group">
      <input class="form-control" type="text" placeholder="Enter GIA or URL" id="gianum" name="gianum">
      <button class="btn btn-primary" type="button">Get Report</button>
    </div>
  </div>
  

  <script>
    var scanner = new Instascan.Scanner({ video: document.getElementById('preview') });
    var isCameraOn = false;
    scanner.addListener('scan', function (content) {
      document.getElementById("gianum").value=content;
   });

    document.getElementById('toggleButton').addEventListener('click', function() {
        if (!isCameraOn) {
            startCamera();
        } else {
            stopCamera();
        }
    });

    function startCamera() {
     Instascan.Camera.getCameras().then(function (cameras) {
       if (cameras.length > 1) {
         scanner.start(cameras[1]);
       }
       else if(cameras.length > 0){
        scanner.start(cameras[0]);
       } else {
         console.error('No cameras found.');
       }
        isCameraOn = true;
        document.getElementById('toggleButton').textContent = 'Stop Camera';
        }).catch(function(e) {
            console.error(e);
        });
    }

    function stopCamera() {
      Instascan.Camera.getCameras().then(function (cameras) {
      if (cameras.length > 1) {
        scanner.stop(cameras[1]);
      }
      else if(cameras.length > 0){
       scanner.stop(cameras[0]);
      }
    });
        isCameraOn = false;
        document.getElementById('toggleButton').textContent = 'Start Camera';
    }
</script>
{%endblock content%}